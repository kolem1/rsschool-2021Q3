(()=>{"use strict";function t(t,e){return t=Math.ceil(t),e=Math.floor(e),Math.floor(Math.random()*(e-t+1))+t}function e(t,e){localStorage.setItem(e,t.value)}function i(t,e){const i=localStorage.getItem(e);i&&(t.value=i)}function n(t){let e=Math.round(t);return(e-(e%=60))/60+(e>9?":":":0")+e}function o(t){let e;return t.forEach((t=>{t.checked&&(e=t.value)})),e}const s=(t,e)=>{let i;return function(){const n=arguments,o=this;i||(t.apply(o,n),i=!0,setTimeout((()=>i=!1),e))}},a=document.querySelector(".city"),r=document.querySelector(".weather-icon"),l=document.querySelector(".temperature"),c=document.querySelector(".wind"),u=document.querySelector(".humidity"),d=document.querySelector(".weather-description");async function h(){"Minsk"!==a.value&&"Минск"!==a.value||(a.value=D.defaultCity[b]);const t=`https://api.openweathermap.org/data/2.5/weather?q=${a.value}&lang=${b}&appid=c553a031b9295379b0b1312b571019d6&units=metric`,e=await fetch(t),i=await e.json();try{r.className=`weather-icon owf owf-${i.weather[0].id}`,l.textContent=`${Math.round(i.main.temp)}°C`,c.textContent=`${D.weather.windSpeed[0][b]} ${Math.round(i.wind.speed)} ${D.weather.windSpeed[1][b]}`,u.textContent=`${D.weather.humidity[b]} ${i.main.humidity}%`,d.textContent=i.weather[0].description}catch{r.className="",l.textContent="",c.textContent="",u.textContent="",d.innerHTML=`<span class="error">${D.weather.error[b]}</span>`}}let m=t(1,20),p=[];function g(){m+=1,m>20&&(m=1),v()}function y(){m-=1,m<1&&(m=20),v()}async function v(){const t=await async function(){const t=function(){const t=(new Date).getHours();let e;switch(!0){case t<6:e="night";break;case t<12:e="morning";break;case t<18:e="afternoon";break;default:e="evening"}return e}(),e=String(m).padStart(2,"0");if("github"===q)return`https://raw.githubusercontent.com/kolem1/stage1-tasks/assets/images/${t}/${e}.jpg`;if("unsplash"===q){const e=`https://api.unsplash.com/photos/random?orientation=landscape&query=${t}&client_id=RezO9Ri1__P_OVBuMahPk6g6ZfoiFTcIm2rC9ZnTUWc`,i=await fetch(e);return(await i.json()).urls.raw+"&w=1920&auto=format&fm=jpg"}if("flickr"===q){let e;if(0===p.length){const i=`https://www.flickr.com/services/rest/?method=flickr.photos.search&api_key=dbec84ec8c52b616139011cf98f9c7fb&tags=${t},nature&extras=url_k&format=json&nojsoncallback=1`,n=await fetch(i);e=await n.json(),p=e.photos.photo.filter((t=>t.url_k))}return p[m].url_k}}(),e=new Image;e.src=t,e.onload=()=>{document.body.style.backgroundImage=`url(${t})`}}const f=document.querySelector(".quote"),S=document.querySelector(".author");let L;function w(){const e=t(0,L[b].length-1);f.textContent=L[b][e].text,S.textContent=L[b][e].author}const k={language:"en",imgSrc:"github",hideBlocks:{time:!1,date:!1,greeting:!1,quotes:!1,weather:!1,player:!1}};let b,q,E,T={};window.addEventListener("beforeunload",(function(){localStorage.setItem("settings",JSON.stringify(T))})),window.addEventListener("load",(function(){const t=localStorage.getItem("settings");t&&(T=JSON.parse(t)),b=T.language||k.language,q=T.imgSrc||k.imgSrc,E=T.hideBlocks||k.hideBlocks,function(t,e){for(let i of t)i.value===e&&(i.checked=!0)}(C,b),function(t,e){let i=0;for(let n of t.options)n.value===e&&(i=n.index);t.selectedIndex=i}(B,q),$(),H()}));const C=document.querySelectorAll(".language-input");function x(){T.language=o(C),b=T.language||k.language,G(),V(),h(),w(),$(),H()}C.forEach((t=>t.addEventListener("change",x)));const B=document.querySelector(".img-src-select");B.addEventListener("change",(function(){var t;T.imgSrc=(t=B).options[t.selectedIndex].value,q=T.imgSrc||k.imgSrc,v()}));const N=document.querySelector(".language-field"),M=document.querySelector(".image-src-field");function $(){N.textContent=D.settings.language[b],M.textContent=D.settings.imgSrc[b]}const I=document.querySelector(".blocks-show-title"),A=document.querySelectorAll(".block-title"),P=document.querySelectorAll(".block-input");function H(){I.textContent=D.settings.bloksTitles.mainBlock[b],A.forEach((t=>{const e=t.dataset.block;t.textContent=D.settings.bloksTitles[e][b]}))}window.addEventListener("load",(()=>{P.forEach((t=>{!function(t){const e=t.dataset.block,i=document.querySelector(`.${e}`);let n=E[e];n&&(i.classList.add("hidden"),t.checked=!1),setTimeout((()=>i.classList.add("animate")),0),t.addEventListener("change",(function(){n?(i.classList.remove("hidden"),T.hideBlocks[e]=!1,T.hideBlocks=E,n=!1):(i.classList.add("hidden"),E[e]=!0,T.hideBlocks=E,n=!0)}))}(t)}))}));const R={timeOfDay:{en:["night","morning","afternoon","evening"],ru:["ночи","утро","день","вечер"]},greeting:{en:["Good","Good","Good","Good"],ru:["Доброй","Доброе","Добрый","Добрый"]},namePlaceholder:{en:"Enter Your Name",ru:"Введите Ваше Имя"},cityPlaceholder:{en:"Enter Your City",ru:"Введите Ваш Город"},defaultCity:{en:"Minsk",ru:"Минск"},weather:{windSpeed:[{en:"Wind speed:",ru:"Скорость ветра:"},{en:"m/s",ru:"м/с"}],humidity:{en:"Humidity:",ru:"Влажность:"},error:{en:"The city is entered incorrectly. Try again",ru:"Город введен неверно. Попробуйте снова"}},settings:{language:{en:"Language",ru:"Язык"},imgSrc:{en:"Image Source",ru:"Источник изображений"},bloksTitles:{mainBlock:{en:"Show Blocks",ru:"Показать блоки"},time:{en:"Time",ru:"Время"},date:{en:"Date",ru:"Дата"},greeting:{en:"Greeting",ru:"Приветствие"},quotes:{en:"Quote",ru:"Цитата"},weather:{en:"Weather",ru:"Погода"},player:{en:"Player",ru:"Плеер"}}}},D=R,O=document.querySelector(".date"),j=document.querySelector(".greeting-container .greeting"),F=document.querySelector(".greeting-container .name");function _(t){!function(t){const e=(new Date).toLocaleTimeString();t.innerHTML=e}(t),G(),V(),setTimeout(_,1e3,t)}function G(){const t=(new Date).toLocaleDateString(b,{weekday:"long",month:"long",day:"numeric"});O.innerHTML=t}function V(){const t=function(){const t=(new Date).getHours();let e;switch(!0){case t<6:e=R.timeOfDay[b][0];break;case t<12:e=R.timeOfDay[b][1];break;case t<18:e=R.timeOfDay[b][2];break;default:e=R.timeOfDay[b][3]}return e}(),e=function(){const t=(new Date).getHours();let e;switch(!0){case t<6:e=R.greeting[b][0];break;case t<12:e=R.greeting[b][1];break;case t<18:e=R.greeting[b][2];break;default:e=R.greeting[b][3]}return e}();F.placeholder=D.namePlaceholder[b],j.innerHTML=`${e} ${t}, `}const W=[{title:"Aqua Caelestis",src:"./assets/sounds/AquaCaelestis.mp3",duration:"00:39"},{title:"Ennio Morricone",src:"./assets/sounds/EnnioMorricone.mp3",duration:"01:37"},{title:"River Flows In You",src:"./assets/sounds/RiverFlowsInYou.mp3",duration:"01:37"},{title:"Summer Wind",src:"./assets/sounds/SummerWind.mp3",duration:"01:50"}];!function(){const t=document.querySelector(".todo-show-button"),e=document.querySelector(".todo");t.addEventListener("click",(()=>{t.classList.toggle("active"),e.classList.toggle("active")})),document.body.addEventListener("click",(function(i){i.target.closest(".todo")||i.target.closest(".todo-show-button")||(t.classList.remove("active"),e.classList.remove("active"))}))}();document.querySelectorAll(".styled-range").forEach((t=>{t.addEventListener("input",(function(){const t=this.value;this.style.background=`linear-gradient(to right, #710707 ${t}%, #C4C4C4 ${t}%)`}))})),function(){const t=document.querySelector(".settings-button"),e=document.querySelector(".settings-wrapper");t.addEventListener("click",(()=>{t.classList.toggle("active"),e.classList.toggle("active")})),document.body.addEventListener("click",(function(i){i.target.closest(".settings-wrapper")||i.target.closest(".settings-button")||(t.classList.remove("active"),e.classList.remove("active"))}))}(),function(t){const n=document.querySelector(".time");window.addEventListener("load",_.bind(null,n)),window.addEventListener("beforeunload",e.bind(null,F,"name")),window.addEventListener("load",i.bind(null,F,"name"))}(),function(){window.addEventListener("load",v);const t=document.querySelector(".slide-next"),e=document.querySelector(".slide-prev");t.addEventListener("click",s(g,2e3)),e.addEventListener("click",s(y,2e3))}(),window.addEventListener("beforeunload",e.bind(null,a,"city")),window.addEventListener("load",(()=>{localStorage.getItem("city")?i(a,"city"):a.value=D.defaultCity[b],h(),a.placeholder=D.cityPlaceholder[b]})),a.addEventListener("change",h),async function(){const t=document.querySelector(".change-quote"),e=await fetch("./assets/quotes.json");L=await e.json(),window.addEventListener("load",w),t.addEventListener("click",w)}(),new class{constructor(t){this.player=document.querySelector(t),this.init()}init(){this.playBtn=this.player.querySelector(".play"),this.progressRange=this.player.querySelector(".player-progress-range"),this.playNextBtn=this.player.querySelector(".play-next"),this.playPrevBtn=this.player.querySelector(".play-prev"),this.playListContainer=this.player.querySelector(".play-list"),this.trackTitle=this.player.querySelector(".player-title"),this.volumeRange=this.player.querySelector(".player-volume-range"),this.volumeButton=this.player.querySelector(".player-volume"),this.currentTimeField=this.player.querySelector(".current-time"),this.durationField=this.player.querySelector(".duration"),this.playNum=0,this.trackTitle.textContent=W[this.playNum].title,this.audio=new Audio,this.audio.src=W[this.playNum].src,this.createPlayList(W),this.playListItems=this.player.querySelectorAll(".play-item"),this.playListButtons=this.player.querySelectorAll(".play-item .play"),this.playNextBtn.addEventListener("click",this.playNext.bind(this)),this.playPrevBtn.addEventListener("click",this.playPrev.bind(this)),this.playBtn.addEventListener("click",this.toggleAudio.bind(this)),this.playListItems.forEach(((t,e)=>t.addEventListener("click",this.playThis.bind(this,e)))),this.audio.volume=parseInt(this.volumeRange.value)/100,this.volumeRange.addEventListener("input",this.handleVolumeUpdate.bind(this)),this.audio.addEventListener("volumechange",this.updateMuteButton.bind(this)),this.volumeButton.addEventListener("click",this.changeMuteAuido.bind(this)),this.audio.addEventListener("play",this.updatePlayElements.bind(this)),this.audio.addEventListener("pause",this.updatePlayElements.bind(this)),this.audio.addEventListener("ended",this.playNext.bind(this)),this.audio.addEventListener("timeupdate",this.changeProgress.bind(this)),this.progressRange.addEventListener("input",this.setProgress.bind(this)),this.audio.onloadeddata=()=>{this.currentTimeField.textContent="0:00",this.durationField.textContent=n(this.audio.duration)},this.audio.addEventListener("timeupdate",this.changeTime.bind(this))}toggleAudio(){this.audio.paused?this.audio.play():this.audio.pause()}updatePlayElements(){this.audio.paused?(this.playBtn.classList.remove("pause"),this.playListButtons[this.playNum].classList.remove("pause")):(this.playBtn.classList.add("pause"),this.playListItems.forEach((t=>t.classList.remove("item-active"))),this.playListItems[this.playNum].classList.add("item-active"),this.playListButtons.forEach((t=>t.classList.remove("pause"))),this.playListButtons[this.playNum].classList.add("pause"))}playNext(){this.playNum++,this.playNum>W.length-1&&(this.playNum=0),this.audio.src=W[this.playNum].src,this.trackTitle.textContent=W[this.playNum].title,this.audio.currentTime=0,this.toggleAudio()}playPrev(){this.playNum--,this.playNum<0&&(this.playNum=W.length-1),this.audio.src=W[this.playNum].src,this.trackTitle.textContent=W[this.playNum].title,this.audio.currentTime=0,this.toggleAudio()}playThis(t){this.playNum!==t&&(this.playNum=t,this.audio.src=W[this.playNum].src,this.trackTitle.textContent=W[this.playNum].title,this.audio.currentTime=0),this.toggleAudio()}changeProgress(){const t=this.audio.duration||1,e=this.audio.currentTime/t*100;this.progressRange.value=e,this.progressRange.style.background=`linear-gradient(to right, #710707 ${e}%, #C4C4C4 ${e}%)`}setProgress(){this.audio.currentTime=this.progressRange.value/100*this.audio.duration}changeTime(){this.currentTimeField.textContent=n(this.audio.currentTime),this.durationField.textContent=n(this.audio.duration)}handleVolumeUpdate(){this.audio.volume=parseInt(this.volumeRange.value)/100}updateMuteButton(){0==this.audio.volume?this.replaceSvgHref(this.volumeButton,"volume-mute"):this.audio.volume<=.25?this.replaceSvgHref(this.volumeButton,"volume-down"):this.audio.volume<=.75?this.replaceSvgHref(this.volumeButton,"volume-middle"):this.replaceSvgHref(this.volumeButton,"volume-up")}changeMuteAuido(){0==this.audio.volume?(this.replaceSvgHref(this.volumeButton,"volume-mute"),this.audio.volume=parseInt(this.volumeRange.value)/100):(this.replaceSvgHref(this.volumeButton,"volume-up"),this.audio.volume=0)}createPlayList(t){t.forEach((t=>{const e=document.createElement("li"),i=document.createElement("button");e.classList.add("play-item"),e.textContent=t.title,i.classList.add("player-icon","play"),e.prepend(i),this.playListContainer.append(e)}))}replaceSvgHref(t,e){const i=t.querySelector("use"),n=i.href.baseVal;i.href.baseVal=n.match(/.+\.svg#/)+e}}(".player"),new class{constructor(){this.todo=document.querySelector(".todo"),this.init()}init(){this.input=this.todo.querySelector(".todo-input"),this.list=this.todo.querySelector(".todos"),this.options=this.todo.querySelectorAll("input[name=todo-option]"),this.loadTodos(),this.input.addEventListener("keypress",(t=>{13==t.which&&(this.createTodo(),this.save())})),this.options.forEach((t=>t.addEventListener("change",this.updateTodos))),this.list.addEventListener("click",this.onClickTodo),document.addEventListener("click",this.action.bind(this))}updateTodos(){const t=o(document.querySelectorAll("input[name=todo-option]"));document.querySelector(".todos").dataset.todoOption=t,document.querySelector(".todo-input").disabled="all"!==t}createTodo(){if(6===document.querySelectorAll(".todo-item").length)return;const t=document.createElement("li");t.classList.add("todo-item"),t.dataset.todoState="active",t.innerHTML=`\n      <input class="todo-checkbox todo-action" type="checkbox" data-todo-action="complete">\n      <span class="todo-task">${this.input.value}</span>\n      <span class="todo-action todo-action-delete" data-todo-action="deleted"></span>`,this.list.appendChild(t),this.input.value=""}loadTodos(){const t=localStorage.getItem("todos");t&&(this.list.innerHTML=t),document.querySelectorAll(".todo-item[data-todo-state=completed]").forEach((t=>{t.querySelector(".todo-checkbox").checked=!0}))}save(){localStorage.setItem("todos",this.list.innerHTML)}action(t){const e=t.target;if(e.classList.contains("todo-action")){const t=e.dataset.todoAction,i=e.closest(".todo-item");"deleted"===t?i.remove():"active"===i.dataset.todoState?i.dataset.todoState="completed":i.dataset.todoState="active",this.save()}}}})();