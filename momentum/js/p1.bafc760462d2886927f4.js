(()=>{"use strict";function e(e,t){return e=Math.ceil(e),t=Math.floor(t),Math.floor(Math.random()*(t-e+1))+e}function t(e,t){localStorage.setItem(t,e.value)}function i(e,t){const i=localStorage.getItem(t);i&&(e.value=i)}function n(e){let t=Math.round(e);return(t-(t%=60))/60+(t>9?":":":0")+t}const a=(e,t)=>{let i;return function(){const n=arguments,a=this;i||(e.apply(a,n),i=!0,setTimeout((()=>i=!1),t))}},s=document.querySelector(".city"),o=document.querySelector(".weather-icon"),r=document.querySelector(".temperature"),l=document.querySelector(".wind"),u=document.querySelector(".humidity"),c=document.querySelector(".weather-description");async function d(){"Minsk"!==s.value&&"Минск"!==s.value||(s.value=R.defaultCity[k]);const e=`https://api.openweathermap.org/data/2.5/weather?q=${s.value}&lang=${k}&appid=c553a031b9295379b0b1312b571019d6&units=metric`,t=await fetch(e),i=await t.json();try{o.className=`weather-icon owf owf-${i.weather[0].id}`,r.textContent=`${Math.round(i.main.temp)}°C`,l.textContent=`${R.weather.windSpeed[0][k]} ${Math.round(i.wind.speed)} ${R.weather.windSpeed[1][k]}`,u.textContent=`${R.weather.humidity[k]} ${i.main.humidity}%`,c.textContent=i.weather[0].description}catch{o.className="",r.textContent="",l.textContent="",u.textContent="",c.innerHTML=`<span class="error">${R.weather.error[k]}</span>`}}let h=e(1,20),m=[];function g(){h+=1,h>20&&(h=1),y()}function p(){h-=1,h<1&&(h=20),y()}async function y(){const e=await async function(){const e=function(){const e=(new Date).getHours();let t;switch(!0){case e<6:t="night";break;case e<12:t="morning";break;case e<18:t="afternoon";break;default:t="evening"}return t}(),t=String(h).padStart(2,"0");if("github"===b)return`https://raw.githubusercontent.com/kolem1/stage1-tasks/assets/images/${e}/${t}.jpg`;if("unsplash"===b){const t=`https://api.unsplash.com/photos/random?orientation=landscape&query=${e}&client_id=RezO9Ri1__P_OVBuMahPk6g6ZfoiFTcIm2rC9ZnTUWc`,i=await fetch(t);return(await i.json()).urls.raw+"&w=1920&auto=format&fm=jpg"}if("flickr"===b){let t;if(0===m.length){const i=`https://www.flickr.com/services/rest/?method=flickr.photos.search&api_key=dbec84ec8c52b616139011cf98f9c7fb&tags=${e},nature&extras=url_k&format=json&nojsoncallback=1`,n=await fetch(i);t=await n.json(),m=t.photos.photo.filter((e=>e.url_k))}return m[h].url_k}}(),t=new Image;t.src=e,t.onload=()=>{document.body.style.backgroundImage=`url(${e})`}}const v=document.querySelector(".quote"),f=document.querySelector(".author");let w;function S(){const t=e(0,w[k].length-1);v.textContent=w[k][t].text,f.textContent=w[k][t].author}const L={language:"en",imgSrc:"github",hideBlocks:{time:!1,date:!1,greeting:!1,quotes:!1,weather:!1,player:!1}};let k,b,E,q={};window.addEventListener("beforeunload",(function(){localStorage.setItem("settings",JSON.stringify(q))})),window.addEventListener("load",(function(){const e=localStorage.getItem("settings");e&&(q=JSON.parse(e)),k=q.language||L.language,b=q.imgSrc||L.imgSrc,E=q.hideBlocks||L.hideBlocks,function(e,t){for(let i of e)i.value===t&&(i.checked=!0)}(C,k),function(e,t){let i=0;for(let n of e.options)n.value===t&&(i=n.index);e.selectedIndex=i}(T,b),$(),A()}));const C=document.querySelectorAll(".language-input");function x(){q.language=function(e){let t;return e.forEach((e=>{e.checked&&(t=e.value)})),t}(C),k=q.language||L.language,_(),G(),d(),S(),$(),A()}C.forEach((e=>e.addEventListener("change",x)));const T=document.querySelector(".img-src-select");T.addEventListener("change",(function(){var e;q.imgSrc=(e=T).options[e.selectedIndex].value,b=q.imgSrc||L.imgSrc,y()}));const B=document.querySelector(".language-field"),N=document.querySelector(".image-src-field");function $(){B.textContent=R.settings.language[k],N.textContent=R.settings.imgSrc[k]}const I=document.querySelector(".blocks-show-title"),M=document.querySelectorAll(".block-title"),P=document.querySelectorAll(".block-input");function A(){I.textContent=R.settings.bloksTitles.mainBlock[k],M.forEach((e=>{const t=e.dataset.block;e.textContent=R.settings.bloksTitles[t][k]}))}window.addEventListener("load",(()=>{P.forEach((e=>{!function(e){const t=e.dataset.block,i=document.querySelector(`.${t}`);let n=E[t];n&&(i.classList.add("hidden"),e.checked=!1),setTimeout((()=>i.classList.add("animate")),0),e.addEventListener("change",(function(){n?(i.classList.remove("hidden"),q.hideBlocks[t]=!1,q.hideBlocks=E,n=!1):(i.classList.add("hidden"),E[t]=!0,q.hideBlocks=E,n=!0)}))}(e)}))}));const H={timeOfDay:{en:["night","morning","afternoon","evening"],ru:["ночи","утро","день","вечер"]},greeting:{en:["Good","Good","Good","Good"],ru:["Доброй","Доброе","Добрый","Добрый"]},namePlaceholder:{en:"Enter Your Name",ru:"Введите Ваше Имя"},cityPlaceholder:{en:"Enter Your City",ru:"Введите Ваш Город"},defaultCity:{en:"Minsk",ru:"Минск"},weather:{windSpeed:[{en:"Wind speed:",ru:"Скорость ветра:"},{en:"m/s",ru:"м/с"}],humidity:{en:"Humidity:",ru:"Влажность:"},error:{en:"The city is entered incorrectly. Try again",ru:"Город введен неверно. Попробуйте снова"}},settings:{language:{en:"Language",ru:"Язык"},imgSrc:{en:"Image Source",ru:"Источник изображений"},bloksTitles:{mainBlock:{en:"Show Blocks",ru:"Показать блоки"},time:{en:"Time",ru:"Время"},date:{en:"Date",ru:"Дата"},greeting:{en:"Greeting",ru:"Приветствие"},quotes:{en:"Quote",ru:"Цитата"},weather:{en:"Weather",ru:"Погода"},player:{en:"Player",ru:"Плеер"}}}},R=H,D=document.querySelector(".date"),j=document.querySelector(".greeting-container .greeting"),F=document.querySelector(".greeting-container .name");function O(e){!function(e){const t=(new Date).toLocaleTimeString();e.innerHTML=t}(e),_(),G(),setTimeout(O,1e3,e)}function _(){const e=(new Date).toLocaleDateString(k,{weekday:"long",month:"long",day:"numeric"});D.innerHTML=e}function G(){const e=function(){const e=(new Date).getHours();let t;switch(!0){case e<6:t=H.timeOfDay[k][0];break;case e<12:t=H.timeOfDay[k][1];break;case e<18:t=H.timeOfDay[k][2];break;default:t=H.timeOfDay[k][3]}return t}(),t=function(){const e=(new Date).getHours();let t;switch(!0){case e<6:t=H.greeting[k][0];break;case e<12:t=H.greeting[k][1];break;case e<18:t=H.greeting[k][2];break;default:t=H.greeting[k][3]}return t}();F.placeholder=R.namePlaceholder[k],j.innerHTML=`${t} ${e}, `}const V=[{title:"Aqua Caelestis",src:"./assets/sounds/AquaCaelestis.mp3",duration:"00:39"},{title:"Ennio Morricone",src:"./assets/sounds/EnnioMorricone.mp3",duration:"01:37"},{title:"River Flows In You",src:"./assets/sounds/RiverFlowsInYou.mp3",duration:"01:37"},{title:"Summer Wind",src:"./assets/sounds/SummerWind.mp3",duration:"01:50"}];document.querySelectorAll(".styled-range").forEach((e=>{e.addEventListener("input",(function(){const e=this.value;this.style.background=`linear-gradient(to right, #710707 ${e}%, #C4C4C4 ${e}%)`}))})),function(){const e=document.querySelector(".settings-button"),t=document.querySelector(".settings-wrapper");e.addEventListener("click",(()=>{e.classList.toggle("active"),t.classList.toggle("active")})),document.body.addEventListener("click",(function(i){i.target.closest(".settings-wrapper")||i.target.closest(".settings-button")||(e.classList.remove("active"),t.classList.remove("active"))}))}(),function(e){const n=document.querySelector(".time");window.addEventListener("load",O.bind(null,n)),window.addEventListener("beforeunload",t.bind(null,F,"name")),window.addEventListener("load",i.bind(null,F,"name"))}(),function(){window.addEventListener("load",y);const e=document.querySelector(".slide-next"),t=document.querySelector(".slide-prev");e.addEventListener("click",a(g,2e3)),t.addEventListener("click",a(p,2e3))}(),window.addEventListener("beforeunload",t.bind(null,s,"city")),window.addEventListener("load",(()=>{localStorage.getItem("city")?i(s,"city"):s.value=R.defaultCity[k],d(),s.placeholder=R.cityPlaceholder[k]})),s.addEventListener("change",d),async function(){const e=document.querySelector(".change-quote"),t=await fetch("./assets/quotes.json");w=await t.json(),window.addEventListener("load",S),e.addEventListener("click",S)}(),new class{constructor(e){this.player=document.querySelector(e),this.init()}init(){this.playBtn=this.player.querySelector(".play"),this.progressRange=this.player.querySelector(".player-progress-range"),this.playNextBtn=this.player.querySelector(".play-next"),this.playPrevBtn=this.player.querySelector(".play-prev"),this.playListContainer=this.player.querySelector(".play-list"),this.trackTitle=this.player.querySelector(".player-title"),this.volumeRange=this.player.querySelector(".player-volume-range"),this.volumeButton=this.player.querySelector(".player-volume"),this.currentTimeField=this.player.querySelector(".current-time"),this.durationField=this.player.querySelector(".duration"),this.playNum=0,this.trackTitle.textContent=V[this.playNum].title,this.audio=new Audio,this.audio.src=V[this.playNum].src,this.createPlayList(V),this.playListItems=this.player.querySelectorAll(".play-item"),this.playListButtons=this.player.querySelectorAll(".play-item .play"),this.playNextBtn.addEventListener("click",this.playNext.bind(this)),this.playPrevBtn.addEventListener("click",this.playPrev.bind(this)),this.playBtn.addEventListener("click",this.toggleAudio.bind(this)),this.playListItems.forEach(((e,t)=>e.addEventListener("click",this.playThis.bind(this,t)))),this.audio.volume=parseInt(this.volumeRange.value)/100,this.volumeRange.addEventListener("input",this.handleVolumeUpdate.bind(this)),this.audio.addEventListener("volumechange",this.updateMuteButton.bind(this)),this.volumeButton.addEventListener("click",this.changeMuteAuido.bind(this)),this.audio.addEventListener("play",this.updatePlayElements.bind(this)),this.audio.addEventListener("pause",this.updatePlayElements.bind(this)),this.audio.addEventListener("ended",this.playNext.bind(this)),this.audio.addEventListener("timeupdate",this.changeProgress.bind(this)),this.progressRange.addEventListener("input",this.setProgress.bind(this)),this.audio.onloadeddata=()=>{this.currentTimeField.textContent="0:00",this.durationField.textContent=n(this.audio.duration)},this.audio.addEventListener("timeupdate",this.changeTime.bind(this))}toggleAudio(){this.audio.paused?this.audio.play():this.audio.pause()}updatePlayElements(){this.audio.paused?(this.playBtn.classList.remove("pause"),this.playListButtons[this.playNum].classList.remove("pause")):(this.playBtn.classList.add("pause"),this.playListItems.forEach((e=>e.classList.remove("item-active"))),this.playListItems[this.playNum].classList.add("item-active"),this.playListButtons.forEach((e=>e.classList.remove("pause"))),this.playListButtons[this.playNum].classList.add("pause"))}playNext(){this.playNum++,this.playNum>V.length-1&&(this.playNum=0),this.audio.src=V[this.playNum].src,this.trackTitle.textContent=V[this.playNum].title,this.audio.currentTime=0,this.toggleAudio()}playPrev(){this.playNum--,this.playNum<0&&(this.playNum=V.length-1),this.audio.src=V[this.playNum].src,this.trackTitle.textContent=V[this.playNum].title,this.audio.currentTime=0,this.toggleAudio()}playThis(e){this.playNum!==e&&(this.playNum=e,this.audio.src=V[this.playNum].src,this.trackTitle.textContent=V[this.playNum].title,this.audio.currentTime=0),this.toggleAudio()}changeProgress(){const e=this.audio.duration||1,t=this.audio.currentTime/e*100;this.progressRange.value=t,this.progressRange.style.background=`linear-gradient(to right, #710707 ${t}%, #C4C4C4 ${t}%)`}setProgress(){this.audio.currentTime=this.progressRange.value/100*this.audio.duration}changeTime(){this.currentTimeField.textContent=n(this.audio.currentTime),this.durationField.textContent=n(this.audio.duration)}handleVolumeUpdate(){this.audio.volume=parseInt(this.volumeRange.value)/100}updateMuteButton(){0==this.audio.volume?this.replaceSvgHref(this.volumeButton,"volume-mute"):this.audio.volume<=.25?this.replaceSvgHref(this.volumeButton,"volume-down"):this.audio.volume<=.75?this.replaceSvgHref(this.volumeButton,"volume-middle"):this.replaceSvgHref(this.volumeButton,"volume-up")}changeMuteAuido(){0==this.audio.volume?(this.replaceSvgHref(this.volumeButton,"volume-mute"),this.audio.volume=parseInt(this.volumeRange.value)/100):(this.replaceSvgHref(this.volumeButton,"volume-up"),this.audio.volume=0)}createPlayList(e){e.forEach((e=>{const t=document.createElement("li"),i=document.createElement("button");t.classList.add("play-item"),t.textContent=e.title,i.classList.add("player-icon","play"),t.prepend(i),this.playListContainer.append(t)}))}replaceSvgHref(e,t){const i=e.querySelector("use"),n=i.href.baseVal;i.href.baseVal=n.match(/.+\.svg#/)+t}}(".player")})();